title: 'Issues detailed view'
output:
  format: html
  filename: 'docs/issue.html'
setup: |
    function sleep(milliseconds) {
      const date = Date.now();
      let currentDate = null;
      do {currentDate = Date.now();} 
      while (currentDate - date < milliseconds);
    }
    userdata.count = async function(repo,label) {
      sleep(2000)
      var results;
      if(label === "" ) {
        results = await github.search.issuesAndPullRequests(
        { q: `repo:${repo} is:issue is:open -label:enhancement` }
        )
      }
      else if(label === "closed"){
        results = await github.search.issuesAndPullRequests(
        { q: `repo:${repo} is:issue is:closed closed:>${date("-30 days")}`}
        )
      }
      else if(label === "stale") {
        results = await github.search.issuesAndPullRequests(
        { q: `repo:${repo} is:issue is:open -label:enhancement created:<${date("-90 days")}`}
        )
      }
      else if(label === "idle"){
        results = await github.search.issuesAndPullRequests(
        { q: `repo:${repo} is:issue is:open label:idle -label:enhancement`}
        )
      }
      else {
        results = await github.search.issuesAndPullRequests(
        { q: `repo:${repo} is:issue is:open label:${label}`}
        )
      }
      if(results.data.items.length === 0){
        return '0'
      }
      else{
        return results.data.total_count
      }
    }
    userdata.url = async function(repo,label) {
      sleep(2000)
      var url;
      var today = new Date();
      var pastDate = new Date(today);
      if(label === "" ) {
        url = 'https://github.com/'+repo+'/issues?q=is%3Aissue+is%3A'+ 'open'+ ' -label%3Aenhancement'
      }
      else if(label === "closed"){
        pastDate.setDate(pastDate.getDate() - 30);
        var closedDate = pastDate.toISOString().split("T")[0];
        url = 'https://github.com/' + repo + '/issues?q=is%3Aissue+is%3A' + 'closed' + '+closed%3A>'+ closedDate
      }
      else if(label === "stale") {
        pastDate.setDate(pastDate.getDate() - 90);
        var staledate = pastDate.toISOString().split("T")[0];
        url = 'https://github.com/' + repo + '/issues?q=is%3Aissue+is%3A' + 'open' + '+created%3A<'+staledate + ' -label%3Aenhancement'
      }
      else if(label === "idle") {
        url = 'https://github.com/' + repo + '/issues?q=is%3Aissue+is%3A' + 'open' + '+label%3A'+ 'idle' + ' -label%3Aenhancement'
      }
      else{
        url = 'https://github.com/'+repo+'/issues?q=is%3Aissue+is%3A'+'open'+'+label%3A'+label
      }
      return url
    } 
    userdata.color = async function(value,label) {
        var resultColor='#FFFFFF'
        if((label === '') && (value>5))
            resultColor='red'
        else if((label === 'need-to-triage') && (value>3))
            resultColor='yellow'
        else if((label === 'stale') && (value>3))
            resultColor='red'
        return resultColor
    }
sections:
- title: '' 
  widgets:
  - type: 'table'
    headers:
    - 'Action'
    - 'Open (excl. enhancements)'
    - 'Need-to-triage'
    - 'Enhancement'
    - 'Question'
    - 'Bug'
    - 'Documentation'
    - 'Performance-issue'
    - 'Waiting-for-customer'
    - 'External-dependency'
    - 'Idle(inactive>14days)'
    - 'Stale(90_days old)'
    - 'Closed(last_30 days)'
    elements:
    - - value: 'azure login'
      - value: '{{ userdata.count("Azure/login","") }}'
        url: '{{ userdata.url("Azure/login","") }}'
      - value: '{{ userdata.count("Azure/login","need-to-triage") }}'
        url: '{{ userdata.url("Azure/login","need-to-triage") }}'
      - value: '{{ userdata.count("Azure/login","enhancement") }}'
        url: '{{ userdata.url("Azure/login","enhancement") }}'
      - value: '{{ userdata.count("Azure/login","question") }}'
        url: '{{ userdata.url("Azure/login","question") }}'
      - value: '{{ userdata.count("Azure/login","bug") }}'
        url: '{{ userdata.url("Azure/login","bug") }}'
      - value: '{{ userdata.count("Azure/login","documentation") }}'
        url: '{{ userdata.url("Azure/login","documentation") }}'
      - value: '{{ userdata.count("Azure/login","performance-issue") }}'
        url: '{{ userdata.url("Azure/login","performance-issue") }}'
      - value: '{{ userdata.count("Azure/login","waiting-for-customer") }}'
        url: '{{ userdata.url("Azure/login","waiting-for-customer") }}'
      - value: '{{ userdata.count("Azure/login","external-dependency") }}'
        url: '{{ userdata.url("Azure/login","external-dependency") }}'
      - value: '{{ userdata.count("Azure/login","idle") }}'
        url: '{{ userdata.url("Azure/login","idle") }}'
      - value: '{{ userdata.count("Azure/login","stale") }}'
        url: '{{ userdata.url("Azure/login","stale") }}'
      - value: '{{ userdata.count("Azure/login","closed") }}'
        url: '{{ userdata.url("Azure/login","closed") }}'
        
    - - value: 'webapps-deploy'
      - value: '{{ userdata.count("Azure/webapps-deploy","") }}'
        url: '{{ userdata.url("Azure/webapps-deploy","") }}'
        color: '{{ userdata.url(value,"") }}'
      - value: '10' #'{{ userdata.count("Azure/webapps-deploy","need-to-triage") }}'
        url: '{{ userdata.url("Azure/webapps-deploy","need-to-triage") }}'
        color: '{{ userdata.url(value,"need-to-triage") }}'
      - value: '{{ userdata.count("Azure/webapps-deploy","enhancement") }}'
        url: '{{ userdata.url("Azure/webapps-deploy","enhancement") }}'
      - value: '{{ userdata.count("Azure/webapps-deploy","question") }}'
        url: '{{ userdata.url("Azure/webapps-deploy","question") }}'
      - value: '{{ userdata.count("Azure/webapps-deploy","bug") }}'
        url: '{{ userdata.url("Azure/webapps-deploy","bug") }}'
      - value: '{{ userdata.count("Azure/webapps-deploy","documentation") }}'
        url: '{{ userdata.url("Azure/webapps-deploy","documentation") }}'
      - value: '{{ userdata.count("Azure/webapps-deploy","performance-issue") }}'
        url: '{{ userdata.url("Azure/webapps-deploy","performance-issue") }}'
      - value: '{{ userdata.count("Azure/webapps-deploy","waiting-for-customer") }}'
        url: '{{ userdata.url("Azure/webapps-deploy","waiting-for-customer") }}'
      - value: '{{ userdata.count("Azure/webapps-deploy","external-dependency") }}'
        url: '{{ userdata.url("Azure/webapps-deploy","external-dependency") }}'
      - value: '{{ userdata.count("Azure/webapps-deploy","idle") }}'
        url: '{{ userdata.url("Azure/webapps-deploy","idle") }}'
      - value: '{{ userdata.count("Azure/webapps-deploy","stale") }}'
        url: '{{ userdata.url("Azure/webapps-deploy","stale") }}'
      - value: '{{ userdata.count("Azure/webapps-deploy","closed") }}'
        url: '{{ userdata.url("Azure/webapps-deploy","closed") }}'

